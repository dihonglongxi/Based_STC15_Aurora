C51 COMPILER V9.53.0.0   AURORA_9X18                                                       01/03/2016 21:36:55 PAGE 1   


C51 COMPILER V9.53.0.0, COMPILATION OF MODULE AURORA_9X18
OBJECT MODULE PLACED IN ..\ProjOut\Aurora_9x18.obj
COMPILER INVOKED BY: C:\Program Files\Keil\C51\BIN\C51.EXE ..\ProgSource\Aurora_9x18.c LARGE OPTIMIZE(8,SPEED) PRINT(..\
                    -ProjList\Aurora_9x18.lst) OBJECT(..\ProjOut\Aurora_9x18.obj)

line level    source

   1          /******************************************************************************
   2            Copyright(C), 2015, é¾™æ›¦å·¥ä½œå®¤
   3            
   4            File name: Aurora_9x18.c
   5          
   6            Author: éƒ­ä¸–å…¨ Version: v0.10.0 Date: 2015.03.25 Website: longxi-team.cn
   7          
   8            Description:    // ç”¨äºè¯¦ç»†è¯´æ˜æ­¤ç¨‹åºæ–‡ä»¶å®Œæˆçš„ä¸»è¦åŠŸèƒ½ï¼Œä¸å…¶ä»–æ¨¡å—
   9          
  10                            // æˆ–å‡½æ•°çš„æ¥å£ï¼Œè¾“å‡ºå€¼ã€å–å€¼èŒƒå›´ã€å«ä¹‰åŠå‚æ•°é—´çš„æ§
  11          
  12                            // åˆ¶ã€é¡ºåºã€ç‹¬ç«‹æˆ–ä¾èµ–ç­‰å…³ç³»
  13          
  14            Others:         // å…¶å®ƒå†…å®¹çš„è¯´æ˜
  15          
  16            Function List:  // ä¸»è¦å‡½æ•°åˆ—è¡¨ï¼Œæ¯æ¡è®°å½•åº”åŒ…æ‹¬å‡½æ•°ååŠåŠŸèƒ½ç®€è¦è¯´æ˜
  17          
  18              1. ....
  19          
  20            History:        
  21          
  22              1. Date: 2015.02.25
  23                 Author: éƒ­ä¸–å…¨
  24                 Modification: å»ºç«‹Aurora_9x18.cæ¡†æ¶
  25          
  26              2. ..
  27          ******************************************************************************/
  28          
  29          /**************************ç³»ç»Ÿé…ç½®ï¼ˆç”¨æˆ·ä¸å¯æ›´æ”¹ï¼‰***************************/
  30          /*è°ƒç”¨STC15F2K60S2åº•å±‚ç¡¬ä»¶å®šä¹‰å¤´æ–‡ä»¶*/
  31          #include "..\ProgInc\STC15F2K60S2.H"
  32          #include  <stdio.h> //è°ƒè¯•ä¸²å£è¾“å‡ºä½¿ç”¨
  33          
  34          /*å®šä¹‰ä¸»æ—¶é’Ÿ, 27MHz*/
  35          #define MAIN_Fosc       27000000L
  36          
  37          /*****************************************************************************/
  38          
  39          
  40          /***************************ç³»ç»Ÿé…ç½®ï¼ˆç”¨æˆ·å¯æ›´æ”¹ï¼‰****************************/
  41          
  42          /********************************PWMå‚æ•°è®¾ç½®**********************************/
  43          /*è®¾ç½®æœ€å¤§PWMå€¼*/
  44          #define MAX_DUTY 0xFF
  45          /*è¡¥å¿LED/åˆ—é©±åŠ¨å™¨çš„å…³é—­æ—¶é—´*/
  46          #define PORT_DELAY 42
  47          /*è¡¥å¿LED/åˆ—é©±åŠ¨å™¨çš„å¼€å¯æ—¶é—´*/
  48          #define PORT_DELAY_COMP 0
  49          /*è¡¥å¿RGBé©±åŠ¨å…³é—­æ—¶é—´*/
  50          #define PORT_BLANK 68
  51          /*LED refresh time = (pr_value+1)*(3*127+1)*Tcy = (pr_value+1)*382*Tcy*/
  52          /*åŠ¨æ€é¢‘ç‡ä¸º 225 Hzï¼ŒTcy = 74.1ns*/
  53          #define PR_VALUE 157
  54          
C51 COMPILER V9.53.0.0   AURORA_9X18                                                       01/03/2016 21:36:55 PAGE 2   

  55          /*ç©ºé—²æ¨¡å¼ä¸‹PCAè®¡æ•°ï¼Œsysclk/2åšè„‰å†²æºï¼Œæ— ä¸­æ–­*/
  56          #define CMOD_VAL 0x02
  57          /*ä½¿èƒ½PWMæ¨¡å¼*/
  58          #define CCAPMX_VAL 0x82
  59          /*è®¾ç½®PWMå·¥ä½œåœ¨8ä½PWMæ¨¡å¼ä¸‹*/
  60          #define PCA_PWMX_VAL 0x00
  61          /*è®¾ç½®PWMçš„è¾“å‡ºç®¡è„šä¸ºP35ã€P36ã€P37*/
  62          #define P_SW1_VAL ((P_SW1 & 0xCF) | 0x10)
  63          /*è®¾ç½®PWMå¼€å¯æ ‡è¯†*/
  64          #define PWM_START 1
  65          /*è®¾ç½®PWMç»“æŸæ ‡è¯†*/
  66          #define PWM_END 0
  67          /*****************************************************************************/
  68          
  69          /******************************COLï¼†ROWé©±åŠ¨å‚æ•°*******************************/
  70          #define COL_POL 0                    /*1-9ç¯åœˆé©±åŠ¨ä¸ºä½ç”µå¹³æœ‰æ•ˆ*/
  71          #define ROW_POL 1                    /*RGBé©±åŠ¨ä¸ºé«˜ç”µå¹³æœ‰æ•ˆ*/
  72          
  73          #define num_COLs 9                   /*åœˆæ•°ä¸º9*/
  74          #define num_ROWs 1                   /*è¡Œæ•°ç­‰æ•ˆä¸º1*/
  75          #define num_LEDs num_COLs*num_ROWs   /*ç­‰æ•ˆæ€»LEDæ•°ä¸º9*/
  76          /*****************************************************************************/
  77          
  78          /*****************************ç«¯å£ä¸I / Oå¼•è„šæ˜ å°„*****************************/
  79          /*LEDæ§åˆ¶ç«¯å£å®šä¹‰*/
  80          #define LED_1_PIN P11
  81          #define LED_2_PIN P12
  82          #define LED_3_PIN P13
  83          #define LED_4_PIN P14
  84          #define LED_5_PIN P15
  85          #define LED_6_PIN P16
  86          #define LED_7_PIN P17
  87          #define LED_8_PIN P54
  88          #define LED_9_PIN P55
  89          
  90          /*RGBæ€»çº¿ï¼ˆPWMï¼‰ç«¯å£å®šä¹‰*/
  91          #define PWM_R_PIN P35
  92          #define PWM_G_PIN P36
  93          #define PWM_B_PIN P37
  94          
  95          /*RGBæ€»çº¿è¾“å‡ºè„‰å®½ï¼ˆä½ç”µå¹³è¾“å‡ºæ—¶é—´ï¼‰*/
  96          #define PWM_R_VALUE CCAP0H
  97          #define PWM_G_VALUE CCAP1H
  98          #define PWM_B_VALUE CCAP2H
  99          
 100          /*RGBæ€»çº¿å…¨å±€è®¾å®šé¡¹*/
 101          #define PWM_GLOBAL_SETTINGS CMOD
 102          
 103          /*RGBæ€»çº¿è¾“å‡ºä½¿èƒ½*/
 104          #define PWM_R_ENABLE CCAPM0
 105          #define PWM_G_ENABLE CCAPM1
 106          #define PWM_B_ENABLE CCAPM2
 107          
 108          /*RGBæ€»çº¿è¾“å‡ºæ¨¡å¼*/
 109          #define PWM_R_MODE PCA_PWM0
 110          #define PWM_G_MODE PCA_PWM1
 111          #define PWM_B_MODE PCA_PWM2
 112          
 113          /*RGBæ€»çº¿è¾“å‡ºæ§åˆ¶*/
 114          #define PWM_OUTPUT_CONTROL CR
 115          /*****************************************************************************/
 116          
C51 COMPILER V9.53.0.0   AURORA_9X18                                                       01/03/2016 21:36:55 PAGE 3   

 117          /*********************************åŠ¨ç”»å‚æ•°************************************/
 118          typedef struct anim_params
 119          {
 120              unsigned char delay;
 121              unsigned char duty_diff;
 122              unsigned char step_up;
 123              unsigned char step_down;
 124              unsigned char update_rate;
 125              unsigned char update;
 126              unsigned char max_duty;
 127              unsigned char release_waitH;         /*å°†åœ¨å¤šé•¿æ—¶é—´åè¿›è¡Œé«˜ç”µå¹³è¾“å‡º*/
 128              unsigned char release_waitL;         /*å°†åœ¨å¤šé•¿æ—¶é—´åè¿›è¡Œä½ç”µå¹³è¾“å‡º*/
 129              unsigned char anim_flags;
 130              unsigned char release_cnt[num_LEDs]; /*æ¯è¡ŒLEDçš„æŒç»­ç‚¹äº®æ—¶é—´*/
 131          }anim_params;
 132          
 133          anim_params RED,GREEN,BLUE;
 134                  
 135          /*****************************************************************************/
 136          
 137          /************LED data - duty levels, and other parameters/flags***************/
 138          
 139          unsigned char LED_data_R[num_LEDs];
 140          unsigned char LED_data_G[num_LEDs];
 141          unsigned char LED_data_B[num_LEDs];
 142          
 143          /*****************************************************************************/
 144          
 145          /************************for LED refresh/interrupt****************************/
 146          unsigned char RGB;
 147          
 148          unsigned char duty_buff_R[num_LEDs];
 149          unsigned char duty_buff_G[num_LEDs];
 150          unsigned char duty_buff_B[num_LEDs];
 151          unsigned char port_buff[3];
 152          
 153          /*****************************************************************************/
 154          
 155          /*****************************************************************************/
 156          
 157          /******************************************************************************
 158            Function:       void aurora_init(void)
 159          
 160            Description:    ç”¨äºAuroraè®¾å¤‡åˆå§‹åŒ–
 161          
 162            Calls:          // è¢«æœ¬å‡½æ•°è°ƒç”¨çš„å‡½æ•°æ¸…å•
 163          
 164            Called By:      // è°ƒç”¨æœ¬å‡½æ•°çš„å‡½æ•°æ¸…å•
 165          
 166            Table Accessed: // è¢«è®¿é—®çš„è¡¨ï¼ˆæ­¤é¡¹ä»…å¯¹äºç‰µæ‰¯åˆ°æ•°æ®åº“æ“ä½œçš„ç¨‹åºï¼‰
 167          
 168            Table Updated:  // è¢«ä¿®æ”¹çš„è¡¨ï¼ˆæ­¤é¡¹ä»…å¯¹äºç‰µæ‰¯åˆ°æ•°æ®åº“æ“ä½œçš„ç¨‹åºï¼‰
 169          
 170            Input:          // è¾“å…¥å‚æ•°è¯´æ˜ï¼ŒåŒ…æ‹¬æ¯ä¸ªå‚æ•°çš„ä½œ
 171          
 172                            // ç”¨ã€å–å€¼è¯´æ˜åŠå‚æ•°é—´å…³ç³»ã€‚
 173          
 174            Output:         // å¯¹è¾“å‡ºå‚æ•°çš„è¯´æ˜ã€‚
 175          
 176            Return:         // å‡½æ•°è¿”å›å€¼çš„è¯´æ˜
 177          
 178            Others:         // å…¶å®ƒè¯´æ˜
C51 COMPILER V9.53.0.0   AURORA_9X18                                                       01/03/2016 21:36:55 PAGE 4   

 179          
 180          ******************************************************************************/
 181          void aurora_init(void)
 182          {
 183   1          ;
 184   1      }
 185          
 186          void UartInit(void)             //9600bps@27MHz
 187          {
 188   1              SCON = 0x50;            //8ä½æ•°æ®,å¯å˜æ³¢ç‰¹ç‡
 189   1              AUXR |= 0x40;           //å®šæ—¶å™¨1æ—¶é’Ÿä¸ºFosc,å³1T
 190   1              AUXR &= 0xFE;           //ä¸²å£1é€‰æ‹©å®šæ—¶å™¨1ä¸ºæ³¢ç‰¹ç‡å‘ç”Ÿå™¨
 191   1              TMOD &= 0x0F;           //è®¾å®šå®šæ—¶å™¨1ä¸º16ä½è‡ªåŠ¨é‡è£…æ–¹å¼
 192   1              TL1 = 0x41;             //è®¾å®šå®šæ—¶åˆå€¼
 193   1              TH1 = 0xFD;             //è®¾å®šå®šæ—¶åˆå€¼
 194   1              ET1 = 0;                //ç¦æ­¢å®šæ—¶å™¨1ä¸­æ–­
 195   1              TR1 = 1;                //å¯åŠ¨å®šæ—¶å™¨1
 196   1          ES = 0;             //ç¦æ­¢ä¸²è¡Œå£ä¸­æ–­
 197   1          TI = 1;             //å¿…é¡»ç½®é«˜TI,RI
 198   1          RI = 1;
 199   1          printf("Uart Initialize Success!\n");
 200   1      }
 201          
 202          void main()
 203          {
 204   1          int a;
 205   1          a = P_SW1_VAL;
 206   1          UartInit();
 207   1          printf ("P_SW1_VAL %d\n",a);
 208   1          while(1)
 209   1          {
 210   2              if(P30 == 0) IAP_CONTR = 0x60;;
 211   2          }
 212   1      }
 213          
 214          
 215          void Timer0() interrupt 1 using 1
 216          {
 217   1        ;
 218   1      }
 219          
 220          void Timer2() interrupt 2 using 1
 221          {
 222   1          switch(RGB)
 223   1          {
 224   2              case 0:
 225   2      
 226   2              case 1:
 227   2      
 228   2              case 2:
 229   2      
 230   2              case 3:
 231   2      
 232   2              default:
 233   2                  RGB = 0;
 234   2                  break;
 235   2          }
 236   1      }
 237          
 238          
 239          
 240          
C51 COMPILER V9.53.0.0   AURORA_9X18                                                       01/03/2016 21:36:55 PAGE 5   

 241          
 242          
 243          /*************************************************
 244          
 245            Function:       // å‡½æ•°åç§°
 246          
 247            Description:    // å‡½æ•°åŠŸèƒ½ã€æ€§èƒ½ç­‰çš„æè¿°
 248          
 249            Calls:          // è¢«æœ¬å‡½æ•°è°ƒç”¨çš„å‡½æ•°æ¸…å•
 250          
 251            Called By:      // è°ƒç”¨æœ¬å‡½æ•°çš„å‡½æ•°æ¸…å•
 252          
 253            Table Accessed: // è¢«è®¿é—®çš„è¡¨ï¼ˆæ­¤é¡¹ä»…å¯¹äºç‰µæ‰¯åˆ°æ•°æ®åº“æ“ä½œçš„ç¨‹åºï¼‰
 254          
 255            Table Updated:  // è¢«ä¿®æ”¹çš„è¡¨ï¼ˆæ­¤é¡¹ä»…å¯¹äºç‰µæ‰¯åˆ°æ•°æ®åº“æ“ä½œçš„ç¨‹åºï¼‰
 256          
 257            Input:          // è¾“å…¥å‚æ•°è¯´æ˜ï¼ŒåŒ…æ‹¬æ¯ä¸ªå‚æ•°çš„ä½œ
 258          
 259                            // ç”¨ã€å–å€¼è¯´æ˜åŠå‚æ•°é—´å…³ç³»ã€‚
 260          
 261            Output:         // å¯¹è¾“å‡ºå‚æ•°çš„è¯´æ˜ã€‚
 262          
 263            Return:         // å‡½æ•°è¿”å›å€¼çš„è¯´æ˜
 264          
 265            Others:         // å…¶å®ƒè¯´æ˜
 266          
 267          *************************************************/
 268          
 269          //void PWM_INIT()
 270          //{
 271          ///*PWMç®¡è„šå®šä¹‰æ–¹å¼1ï¼šP1.2/ECI, P1.1/CCP0, P1.0/CCP1, P3.7/CCP2*/    
 272          //#if PWM_PIN == 1
 273          //    ACC = P_SW1;
 274          //    ACC &= ~(CCP_S0 | CCP_S1);      /*CCP_S0=0;CCP_S1=0*/
 275          //    P_SW1 = ACC;                   
 276          //#endif
 277          
 278          ///*PWMç®¡è„šå®šä¹‰æ–¹å¼2ï¼šP3.4/ECI_2, P3.5/CCP0_2, P3.6/CCP1_2, P3.7/CCP2_2*/ 
 279          //#if PWM_PIN == 2
 280          //    ACC = P_SW1;
 281          //    ACC &= ~(CCP_S0 | CCP_S1);      /*CCP_S0=1;CCP_S1=0*/
 282          //    ACC |= CCP_S0;                  
 283          //    P_SW1 = ACC;  
 284          //#endif
 285          
 286          ///*PWMç®¡è„šå®šä¹‰æ–¹å¼3ï¼šP2.4/ECI_3, P2.5/CCP0_3, P2.6/CCP1_3, P2.7/CCP2_3*/ 
 287          //#if PWM_PIN == 3
 288          //    ACC = P_SW1;
 289          //    ACC &= ~(CCP_S0 | CCP_S1);      /*CCP_S0=0;CCP_S1=1*/
 290          //    ACC |= CCP_S1;                  
 291          //    P_SW1 = ACC;
 292          //#endif
 293          
 294          ////    CCON = 0;                       //åˆå§‹åŒ–PCAæ§åˆ¶å¯„å­˜å™¨
 295          ////    //PCAå®šæ—¶å™¨åœæ­¢
 296          ////    //æ¸…é™¤CFæ ‡å¿—
 297          ////    //æ¸…é™¤æ¨¡å—ä¸­æ–­æ ‡å¿—
 298          ////    CL = 0;                         //å¤ä½PCAå¯„å­˜å™¨
 299          ////    CH = 0;
 300          ////    CMOD = 0x02;                    //è®¾ç½®PCAæ—¶é’Ÿæº
 301          ////    //å…è®¸PCAå®šæ—¶å™¨æº¢å‡ºä¸­æ–­
 302          
C51 COMPILER V9.53.0.0   AURORA_9X18                                                       01/03/2016 21:36:55 PAGE 6   

 303          ////    PCA_PWM0 = 0x03;                //PCAæ¨¡å—0å·¥ä½œäº8ä½PWM
 304          ////    PWM_R = 255;                    //PWM0çš„å ç©ºæ¯”ä¸º87.5% ((100H-20H)/100H) å ç©ºæ¯”255 æ²¡æœ‰é«
             -˜ç‚¹å¹³ é«˜æœ‰æ•ˆé©±åŠ¨
 305          ////    CCAPM0 = 0x53;                  //PWM,ç”±é«˜å˜ä½äº§ç”Ÿä¸­æ–­
 306          
 307          ////    PCA_PWM1 = 0x03;                //PCAæ¨¡å—1
 308          ////    PWM_G = 255;
 309          ////    CCAPM1 = 0x53;
 310          
 311          ////    PCA_PWM2 = 0x03;                //PCAæ¨¡å—2
 312          ////    PWM_B = 255;
 313          ////    CCAPM2 = 0x53;
 314          
 315          ////    EA = 1;                         //ç³»ç»Ÿæ€»ä¸­æ–­
 316          ////    PWM_OFF;                         //PCAå®šæ—¶å™¨å¼€å§‹å·¥ä½œ
 317          //}


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    119    ----
   CONSTANT SIZE    =     40    ----
   XDATA SIZE       =    115       2
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
